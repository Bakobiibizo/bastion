services:
  bastion-relay:
    build: .
    image: bastion-relay:latest
    container_name: bastion-relay
    restart: unless-stopped
    environment:
      - RUST_LOG=info
      - IDENTITY_KEY_PATH=/var/lib/bastion-relay/id.key
    command: >
      --port 4001
      --announce-ip ${ANNOUNCE_IP:-154.5.126.219}
      --identity-key-path /var/lib/bastion-relay/id.key
      --enclave
      --enclave-name "${ENCLAVE_NAME:-Bastion}"
      --data-dir /var/lib/bastion-relay/data
    ports:
      - "4001:4001/tcp"
      - "4001:4001/udp"
      - "4002:4002/tcp"
    volumes:
      - relay-data:/var/lib/bastion-relay

volumes:
  relay-data:
